<div class="dashboard">
  <header class="header">
    <div class="header-top">
      <h1>KPI ダッシュボード</h1>
      <p class="subtitle">AI活用状況・人材育成進捗レポート</p>
    </div>
    <nav class="header-nav">
      <button [class.active]="currentView === 'dashboard'" (click)="currentView = 'dashboard'">ダッシュボード</button>
      <button [class.active]="currentView === 'intro'" (click)="currentView = 'intro'">LLM-CoE紹介</button>
    </nav>
    <button class="data-manage-btn" (click)="openDataModal()" *ngIf="currentView === 'dashboard'">データ管理</button>
  </header>

  <div class="dashboard-grid" *ngIf="currentView === 'dashboard'">
    <!-- Section 1: GAI利用状況 -->
    <section class="card">
      <div class="card-header">
        <h2>GAI利用状況</h2>
      </div>
      <div class="card-content">
        <div class="chart-container">
          <h3>コアユーザ数の月別推移（3部署）</h3>
          <ngx-charts-line-chart
            [results]="coreUserData"
            [scheme]="colorScheme"
            [xAxis]="true"
            [yAxis]="true"
            [legend]="true"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            xAxisLabel="月"
            yAxisLabel="ユーザ数"
            [autoScale]="true"
            [view]="[500, 280]">
          </ngx-charts-line-chart>
        </div>
        <div class="chart-container">
          <h3>利用用途ごとの回数</h3>
          <ngx-charts-bar-horizontal
            [results]="usagePurposeData"
            [scheme]="colorScheme"
            [xAxis]="true"
            [yAxis]="true"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            xAxisLabel="回数"
            yAxisLabel="用途"
            [view]="[500, 280]">
          </ngx-charts-bar-horizontal>
        </div>
      </div>
    </section>

    <!-- Section 2: AI支援状況 -->
    <section class="card">
      <div class="card-header">
        <h2>AI支援状況</h2>
      </div>
      <div class="card-content">
        <div class="sub-section">
          <h3>案件数比較（受託 vs 全量）</h3>
          <div class="ai-support-cards">
            <div class="ai-support-card">
              <div class="ai-support-card-header">PoC</div>
              <div class="ai-support-card-body">
                <div class="progress-bar-container">
                  <div class="progress-bar-label">
                    <span>受託案件</span>
                    <span class="progress-value">{{editData.aiSupport.poc.contracted}}件</span>
                  </div>
                  <div class="progress-bar-track">
                    <div class="progress-bar-fill" [style.width.%]="getPocContractedRatio()"></div>
                  </div>
                </div>
                <div class="progress-bar-container">
                  <div class="progress-bar-label">
                    <span>全量案件</span>
                    <span class="progress-value">{{editData.aiSupport.poc.total}}件</span>
                  </div>
                  <div class="progress-bar-track full">
                    <div class="progress-bar-fill-light" style="width: 100%"></div>
                  </div>
                </div>
                <div class="ratio-display">
                  <span class="ratio-label">受託率</span>
                  <span class="ratio-value">{{getPocContractedRatio()}}%</span>
                </div>
              </div>
            </div>
            <div class="ai-support-card">
              <div class="ai-support-card-header">本番</div>
              <div class="ai-support-card-body">
                <div class="progress-bar-container">
                  <div class="progress-bar-label">
                    <span>受託案件</span>
                    <span class="progress-value">{{editData.aiSupport.production.contracted}}件</span>
                  </div>
                  <div class="progress-bar-track">
                    <div class="progress-bar-fill" [style.width.%]="getProductionContractedRatio()"></div>
                  </div>
                </div>
                <div class="progress-bar-container">
                  <div class="progress-bar-label">
                    <span>全量案件</span>
                    <span class="progress-value">{{editData.aiSupport.production.total}}件</span>
                  </div>
                  <div class="progress-bar-track full">
                    <div class="progress-bar-fill-light" style="width: 100%"></div>
                  </div>
                </div>
                <div class="ratio-display">
                  <span class="ratio-label">受託率</span>
                  <span class="ratio-value">{{getProductionContractedRatio()}}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="sub-section">
          <h3>発注金額比較</h3>
          <div class="amount-comparison">
            <div class="amount-table">
              <div class="amount-row header">
                <div class="amount-cell"></div>
                <div class="amount-cell">受託金額</div>
                <div class="amount-cell">全量金額</div>
                <div class="amount-cell">受託率</div>
              </div>
              <div class="amount-row">
                <div class="amount-cell label">PoC</div>
                <div class="amount-cell value">{{formatYen(editData.aiSupport.amount.poc.contracted)}}</div>
                <div class="amount-cell value">{{formatYen(editData.aiSupport.amount.poc.total)}}</div>
                <div class="amount-cell ratio">{{getPocAmountRatio()}}%</div>
              </div>
              <div class="amount-row">
                <div class="amount-cell label">本番</div>
                <div class="amount-cell value">{{formatYen(editData.aiSupport.amount.production.contracted)}}</div>
                <div class="amount-cell value">{{formatYen(editData.aiSupport.amount.production.total)}}</div>
                <div class="amount-cell ratio">{{getProductionAmountRatio()}}%</div>
              </div>
              <div class="amount-row total">
                <div class="amount-cell label">合計</div>
                <div class="amount-cell value">{{formatYen(getTotalContractedAmount())}}</div>
                <div class="amount-cell value">{{formatYen(getTotalAmount())}}</div>
                <div class="amount-cell ratio">{{getTotalAmountRatio()}}%</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 3: 学習・検証環境の利用状況 -->
    <section class="card">
      <div class="card-header">
        <h2>学習・検証環境の利用状況</h2>
      </div>
      <div class="card-content">
        <div class="metrics-row">
          <div class="metric-card">
            <div class="metric-value">{{editData.learningEnv.departments}}</div>
            <div class="metric-label">利用部署数</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">{{editData.learningEnv.users}}</div>
            <div class="metric-label">登録者数</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">{{formatYen(editData.learningEnv.totalCost)}}</div>
            <div class="metric-label">累計利用金額</div>
          </div>
        </div>
        <div class="chart-container">
          <h3>月別利用金額推移</h3>
          <ngx-charts-area-chart
            [results]="[{name: '利用金額', series: learningEnvCostData}]"
            [scheme]="colorScheme"
            [xAxis]="true"
            [yAxis]="true"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            xAxisLabel="月"
            yAxisLabel="金額"
            [yAxisTickFormatting]="yAxisTickFormatting"
            [autoScale]="true"
            [view]="[500, 250]">
          </ngx-charts-area-chart>
        </div>
      </div>
    </section>

    <!-- Section 4: 人材育成進捗状況 -->
    <section class="card">
      <div class="card-header">
        <h2>人材育成進捗状況</h2>
      </div>
      <div class="card-content">
        <div class="hr-progress-grid">
          <div class="hr-progress-card">
            <div class="hr-progress-header">
              <h3>見習い認定</h3>
              <div class="hr-progress-percentage">{{apprenticeData.percentage}}%</div>
            </div>
            <div class="hr-progress-bar-wrapper">
              <div class="hr-progress-bar-track">
                <div class="hr-progress-bar-fill" [style.width.%]="apprenticeData.percentage"></div>
              </div>
            </div>
            <div class="hr-progress-details">
              <div class="hr-progress-detail">
                <span class="detail-number">{{apprenticeData.certified}}</span>
                <span class="detail-label">認定者数</span>
              </div>
              <div class="hr-progress-divider">/</div>
              <div class="hr-progress-detail">
                <span class="detail-number">{{apprenticeData.total}}</span>
                <span class="detail-label">対象者数</span>
              </div>
            </div>
          </div>
          <div class="hr-progress-card">
            <div class="hr-progress-header">
              <h3>独り立ち認定</h3>
              <div class="hr-progress-percentage">{{independentData.percentage}}%</div>
            </div>
            <div class="hr-progress-bar-wrapper">
              <div class="hr-progress-bar-track">
                <div class="hr-progress-bar-fill" [style.width.%]="independentData.percentage"></div>
              </div>
            </div>
            <div class="hr-progress-details">
              <div class="hr-progress-detail">
                <span class="detail-number">{{independentData.certified}}</span>
                <span class="detail-label">認定者数</span>
              </div>
              <div class="hr-progress-divider">/</div>
              <div class="hr-progress-detail">
                <span class="detail-number">{{independentData.total}}</span>
                <span class="detail-label">対象者数</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer class="footer" *ngIf="currentView === 'dashboard'">
    <p>最終更新: 2025年12月</p>
  </footer>

  <!-- LLM-CoE Intro Page -->
  <div class="intro-page" *ngIf="currentView === 'intro'">
    <section class="intro-hero">
      <div class="intro-hero-content">
        <h2>LLM活用をリードする<br>日本総研のバーチャル組織</h2>
        <p class="intro-subtitle">LLM-CoE（Center of Excellence）</p>
        <div class="intro-company">株式会社日本総合研究所</div>
      </div>
    </section>

    <section class="intro-section intro-about">
      <div class="intro-container">
        <p class="intro-text">
          LLM（大規模言語モデル）がもたらす影響は未知数であり、多くの企業では積極的な活用を推進しつつも、その用途は限定的になっているところもあるのではないでしょうか。
        </p>
        <p class="intro-text">
          日本総研では組織横断型のバーチャル組織「LLM-CoE」を立ち上げ、生成AIに関する様々な取り組みを行っています。日進月歩である生成AIについて、日々の情報収集、発信からグループ内におけるPoC（概念実証）支援まで幅広く活動しています。
        </p>
      </div>
    </section>

    <section class="intro-section">
      <div class="intro-container">
        <h3 class="intro-section-title">LLM-CoEの4つのミッション</h3>
        <div class="missions-grid">
          <div class="mission-card">
            <div class="mission-icon">📡</div>
            <h4>情報収集・調査<br>情報発信</h4>
            <p>生成AIに関する最新情報をキャッチし、「LLM Dojo」コミュニティを通じてグループ全体へ展開</p>
          </div>
          <div class="mission-card">
            <div class="mission-icon">🎓</div>
            <h4>技術者の育成<br>学習・検証環境の整備</h4>
            <p>勉強会やハンズオン講習会の実施、APIを使えるPoC環境の提供</p>
          </div>
          <div class="mission-card">
            <div class="mission-icon">💬</div>
            <h4>相談窓口対応</h4>
            <p>生成AI活用に関する企画段階からの相談対応、適切な部署への橋渡し</p>
          </div>
          <div class="mission-card">
            <div class="mission-icon">🚀</div>
            <h4>PoC支援・推進</h4>
            <p>システム開発への活用検討、レガシーシステムのモダナイゼーション支援</p>
          </div>
        </div>
      </div>
    </section>

    <section class="intro-section intro-members">
      <div class="intro-container">
        <h3 class="intro-section-title">LLM-CoEメンバー</h3>
        <div class="members-grid">
          <div class="member-card">
            <h4>北野 健太</h4>
            <p class="member-role">全体推進リーダー / システム企画部</p>
            <p>2006年入社。先端技術ラボの立ち上げメンバーとして参画し、AIやブロックチェーンなどのリサーチ業務に従事。現在はLLM-CoEの立ち上げから体制構築といった組織全体の運営を担当。</p>
          </div>
          <div class="member-card">
            <h4>西脇 一尊</h4>
            <p class="member-role">事務局・人材育成・情報発信担当 / 先端技術ラボ</p>
            <p>2018年入社。機械学習×バイオインフォマティクスの研究経験を持ち、自然言語処理を専門に技術検証・調査に携わる。Qiitaでの技術発信も積極的に行う。</p>
          </div>
          <div class="member-card">
            <h4>加古 晴也</h4>
            <p class="member-role">環境構築・Azure/GAI関連担当 / グループ社内システム本部</p>
            <p>2021年入社。海外拠点のOA環境クラウド化やAIチャットボット展開を担当。現在は社内全拠点におけるAI導入、生産性向上のためのツール開発を推進。</p>
          </div>
        </div>
      </div>
    </section>

    <section class="intro-section">
      <div class="intro-container">
        <h3 class="intro-section-title">取り組みのハイライト</h3>
        <div class="highlights-list">
          <div class="highlight-item">
            <div class="highlight-number">1</div>
            <div class="highlight-content">
              <h4>LLM Dojoコミュニティの運営</h4>
              <p>日本総研だけでなくSMBCグループ会社も参加可能なコミュニティ。情報交換やQ&A、生成AIに関する最新ニュースの発信を行っています。</p>
            </div>
          </div>
          <div class="highlight-item">
            <div class="highlight-number">2</div>
            <div class="highlight-content">
              <h4>安全性を重視した検証環境の構築</h4>
              <p>金融系システムを扱う企業として、セキュリティーを含むガバナンスを意識。データ流出防止やネットワーク設計に細心の注意を払い、社員が利用しやすい検証環境を実現。</p>
            </div>
          </div>
          <div class="highlight-item">
            <div class="highlight-number">3</div>
            <div class="highlight-content">
              <h4>実践的なハンズオン講習会</h4>
              <p>APIライブラリの使い方を学ぶ対面講習会を実施。参加者からは「思ったより簡単だった」という声が多数。サンプルスクリプトを部内に持ち帰り、業務活用を提案するケースも。</p>
            </div>
          </div>
          <div class="highlight-item">
            <div class="highlight-number">4</div>
            <div class="highlight-content">
              <h4>レガシーシステムのモダナイゼーション</h4>
              <p>ClassicASPからJavaへの変換など、レガシー技術から新しいフレームワークへの変換をAIで支援。Microsoft AI Co-Innovation Labでの検証も実施。</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="intro-cta">
      <div class="intro-container">
        <h3>生成AI活用の未来を一緒に創りませんか？</h3>
        <p>LLM-CoEでは、生成AI利活用推進スタッフとして一緒に働く仲間を募集しています。</p>
        <div class="cta-buttons">
          <a href="https://qiita.com/official-columns/interview/202412-jri/" target="_blank" class="btn-primary">記事を読む</a>
          <a href="https://jri-career.com/career/" target="_blank" class="btn-secondary">採用情報</a>
        </div>
      </div>
    </section>

    <footer class="intro-footer">
      <p>出典: <a href="https://qiita.com/official-columns/interview/202412-jri/" target="_blank">Qiita Zine - LLM活用をリードする、日本総研のバーチャル組織「LLM-CoE」とは</a></p>
      <p>2024年12月6日公開</p>
    </footer>
  </div>
</div>

<!-- Data Management Modal -->
<div class="modal-overlay" *ngIf="showDataModal" (click)="closeDataModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>データ管理</h2>
      <button class="modal-close" (click)="closeDataModal()">&times;</button>
    </div>
    
    <div class="modal-tabs">
      <button [class.active]="activeTab === 'gai'" (click)="activeTab = 'gai'">GAI利用状況</button>
      <button [class.active]="activeTab === 'ai'" (click)="activeTab = 'ai'">AI支援状況</button>
      <button [class.active]="activeTab === 'learning'" (click)="activeTab = 'learning'">学習・検証環境</button>
      <button [class.active]="activeTab === 'hr'" (click)="activeTab = 'hr'">人材育成</button>
    </div>
    
    <div class="modal-body">
      <!-- GAI利用状況 Tab -->
      <div *ngIf="activeTab === 'gai'" class="tab-content">
        <h3>利用用途ごとの回数</h3>
        <div class="form-grid">
          <div class="form-row" *ngFor="let item of editData.gaiUsage.usagePurpose; let i = index">
            <label>{{item.name}}</label>
            <input type="number" [(ngModel)]="editData.gaiUsage.usagePurpose[i].value" />
          </div>
        </div>
      </div>
      
      <!-- AI支援状況 Tab -->
      <div *ngIf="activeTab === 'ai'" class="tab-content">
        <h3>案件数</h3>
        <div class="form-section">
          <h4>PoC</h4>
          <div class="form-row">
            <label>受託案件数</label>
            <input type="number" [(ngModel)]="editData.aiSupport.poc.contracted" />
          </div>
          <div class="form-row">
            <label>全量案件数</label>
            <input type="number" [(ngModel)]="editData.aiSupport.poc.total" />
          </div>
        </div>
        <div class="form-section">
          <h4>本番</h4>
          <div class="form-row">
            <label>受託案件数</label>
            <input type="number" [(ngModel)]="editData.aiSupport.production.contracted" />
          </div>
          <div class="form-row">
            <label>全量案件数</label>
            <input type="number" [(ngModel)]="editData.aiSupport.production.total" />
          </div>
        </div>
        <h3>発注金額（円）</h3>
        <div class="form-section">
          <h4>PoC</h4>
          <div class="form-row">
            <label>受託金額</label>
            <input type="number" [(ngModel)]="editData.aiSupport.amount.poc.contracted" />
          </div>
          <div class="form-row">
            <label>全量金額</label>
            <input type="number" [(ngModel)]="editData.aiSupport.amount.poc.total" />
          </div>
        </div>
        <div class="form-section">
          <h4>本番</h4>
          <div class="form-row">
            <label>受託金額</label>
            <input type="number" [(ngModel)]="editData.aiSupport.amount.production.contracted" />
          </div>
          <div class="form-row">
            <label>全量金額</label>
            <input type="number" [(ngModel)]="editData.aiSupport.amount.production.total" />
          </div>
        </div>
      </div>
      
      <!-- 学習・検証環境 Tab -->
      <div *ngIf="activeTab === 'learning'" class="tab-content">
        <h3>基本情報</h3>
        <div class="form-row">
          <label>利用部署数</label>
          <input type="number" [(ngModel)]="editData.learningEnv.departments" />
        </div>
        <div class="form-row">
          <label>登録者数</label>
          <input type="number" [(ngModel)]="editData.learningEnv.users" />
        </div>
        <div class="form-row">
          <label>累計利用金額（円）</label>
          <input type="number" [(ngModel)]="editData.learningEnv.totalCost" />
        </div>
      </div>
      
      <!-- 人材育成 Tab -->
      <div *ngIf="activeTab === 'hr'" class="tab-content">
        <h3>見習い認定</h3>
        <div class="form-row">
          <label>認定者数</label>
          <input type="number" [(ngModel)]="editData.hrDevelopment.apprentice.certified" />
        </div>
        <div class="form-row">
          <label>対象者数</label>
          <input type="number" [(ngModel)]="editData.hrDevelopment.apprentice.total" />
        </div>
        <h3>独り立ち認定</h3>
        <div class="form-row">
          <label>認定者数</label>
          <input type="number" [(ngModel)]="editData.hrDevelopment.independent.certified" />
        </div>
        <div class="form-row">
          <label>対象者数</label>
          <input type="number" [(ngModel)]="editData.hrDevelopment.independent.total" />
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <div class="modal-actions-left">
        <button class="btn-secondary" (click)="exportData()">エクスポート</button>
        <label class="btn-secondary file-input-label">
          インポート
          <input type="file" accept=".json" (change)="importData($event)" hidden />
        </label>
        <button class="btn-danger" (click)="resetData()">リセット</button>
      </div>
      <div class="modal-actions-right">
        <button class="btn-secondary" (click)="closeDataModal()">キャンセル</button>
        <button class="btn-primary" (click)="saveData()">保存</button>
      </div>
    </div>
  </div>
</div>
